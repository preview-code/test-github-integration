<!--
@license
Copyright (c) 2017 Preview-Code. All rights reserved.
This code may only be used under the BSD style license found in LICENSE.txt
-->
<link rel="import" href="../../bower_components/iron-icons/device-icons.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-material/paper-material.html">
<link rel="import" href="../../bower_components/markdown-input/marked-github-element.html">
<link rel="import" href="../../bower_components/github-ajax/github-ajax.html">
<link rel="import" href="project-behavior.html">

<dom-module id="project-activity">
  <template>
    <style>
      :host {
        display: block;
      }

      paper-material {
        @apply(--constraint-width);
        margin-top: 2em;
        background-color: var(--primary-background-color);
      }

      a {
        text-decoration: none;
        color: var(--secondary-text-color);
      }

      img {
        flex-shrink: 0;
        -webkit-box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.2);
        box-shadow: 0 0 2px 0 rgba(0, 0, 0, 0.2);
        border-radius: 3px;
        vertical-align: -webkit-baseline-middle;
      }

      span {
        padding-left: 0.3em;
        vertical-align: bottom;
      }

      .readme {
        padding: 0.75em;
      }

      .repeat {
        display: inline-block;
        padding: 6px;
      }

      .container {
        text-align: center;
        margin-top: 1em;
        margin-left: 1em;
        margin-right: 1em;
      }
    </style>

    <github-ajax
      id="fetch_readme"
      url="[[backendPath]]/readme"
      content-type="text/markdown"
      handle-as="text"
      headers='{"Accept": "application/vnd.github.VERSION.raw"}'
      last-response="{{readme}}"
    ></github-ajax>

    <github-ajax
      id="fetch_contributors"
      url="[[backendPath]]/contributors"
      last-response="{{contributors}}"
    ></github-ajax>

    <paper-material elevation="1">
      <div class=container>
        <template is="dom-repeat" items="[[contributors]]">
          <div class="repeat">
            <a href="[[item.html_url]]" target="_blank"><img src$="[[item.avatar_url]]" width="24px" height="24px" alt$="[[item.login]]" /></a><span>[[item.login]]</span>
          </div>
        </template>
      </div>

      <div class="readme">
        <marked-github-element markdown="[[readme]]"></marked-github-element>
      </div>
    </paper-material>
  </template>

  <script>
    /*global ProjectBehavior*/
    Polymer({
      is: 'project-activity',
      behaviors: [ProjectBehavior],
      properties: {
        readme: String,
        backendPath: {
          type: String,
          computed: '_updateBackendPath(project)'
        },
      },
      observers: [
        '_fetchInformation(backendPath)'
      ],
      _updateBackendPath: function (project) {
        return 'https://api.github.com/repos/' + [[project.owner]] + '/' + [[project.name]];
      },
      _fetchInformation: function (backendPath) {
        if (backendPath) {
          this.$.fetch_readme.generateRequest();
          this.$.fetch_contributors.generateRequest();
        }
      }
    });
  </script>
</dom-module>