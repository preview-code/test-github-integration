<!--
@license
Copyright (c) 2017 Preview-Code. All rights reserved.
This code may only be used under the BSD style license found in LICENSE.txt
-->
<dom-module id="dom-repeat-once">
  <template>
    <content></content>
  </template>
  <script>
    Polymer({
      is: 'dom-repeat-once',
      properties: {
        items: {
          type: Array,
          value: function () {
            return [];
          }
        }
      },
      reset: function (getItemElem) {
        this.items.sort(function (a, b) {
          if (!b.order || a.order < b.order) return -1;
          if (!a.order || a.order > b.order) return 1;
          return 0;
        });

        this.innerHTML = '';
        var stamped = 0;
        var n = this.items.length;
        var domApi = Polymer.dom(this);
        var items = this.items;
        var _this = this;
        function appendChildren() {
          // A reset was called while we were stamping
          if (items !== _this.items) {
            return;
          }
          var i = 0;
          for (; i < 4 && stamped + i < n; i++) {
            domApi.appendChild(getItemElem(items[stamped + i]));
          }
          stamped += i;
          if (stamped < n) {
            requestAnimationFrame(appendChildren);
          } else {
            // Trigger :empty selector in parents
            _this.style.display = 'block';
          }
        }
        requestAnimationFrame(appendChildren);
      }
    });
  </script>
</dom-module>